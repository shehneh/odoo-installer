client_max_body_size 100M;

# API requests go directly to Flask
location /api/ {
  try_files /dev/null @flask_app;
}

# Static files including HTML from website folder
location ~* \.(gif|jpg|jpeg|png|svg|webp|js|css|ico|otf|ttf|woff|woff2|pdf|html)$ {
  root /usr/src/app/website;
  try_files $uri $uri/ @flask_app;
}

location /public {
  alias /usr/src/app/public;
}

# All other requests go to Flask
location / {
  try_files /dev/null @flask_app;
}

location ~\.sqlite3$ {
  deny all;
  error_page 403 =404 /;
}

# Allow access to .well-known directory
location ~ /\.well-known {
  allow all;
}
